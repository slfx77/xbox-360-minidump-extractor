<?xml version="1.0" encoding="utf-8"?>

<UserControl
  x:Class="Xbox360MemoryCarver.BatchModeTab"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:ctk="using:CommunityToolkit.WinUI.Controls"
  xmlns:local="using:Xbox360MemoryCarver">

  <Grid Padding="16">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!--  TOP: Input/Output Section - transparent for Mica  -->
    <Grid
      Grid.Row="0"
      Margin="0,0,0,8"
      RowSpacing="8">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <!--  Input Directory  -->
      <TextBlock
        Grid.Row="0"
        Grid.Column="0"
        Margin="0,0,12,0"
        VerticalAlignment="Center"
        Text="Input Directory" />
      <TextBox
        x:Name="InputDirectoryTextBox"
        Grid.Row="0"
        Grid.Column="1"
        Margin="0,0,8,0"
        IsReadOnly="True"
        PlaceholderText="Select a folder containing .dmp files..." />
      <Button
        Grid.Row="0"
        Grid.Column="2"
        Click="BrowseInputButton_Click"
        Content="Browse..." />

      <!--  Output Directory  -->
      <TextBlock
        Grid.Row="1"
        Grid.Column="0"
        Margin="0,0,12,0"
        VerticalAlignment="Center"
        Text="Output Directory" />
      <TextBox
        x:Name="OutputDirectoryTextBox"
        Grid.Row="1"
        Grid.Column="1"
        Margin="0,0,8,0"
        IsReadOnly="True"
        PlaceholderText="Select output directory..." />
      <Button
        Grid.Row="1"
        Grid.Column="2"
        Click="BrowseOutputButton_Click"
        Content="Browse..." />
    </Grid>

    <!--  Progress Bar  -->
    <ProgressBar
      x:Name="BatchProgressBar"
      Grid.Row="1"
      Margin="0,0,0,8"
      Visibility="Collapsed"
      Value="0" />

    <!--  MIDDLE: Dump Files List - darker semi-transparent for Mica  -->
    <Border
      Grid.Row="2"
      Padding="8"
      Background="#80202020"
      CornerRadius="8">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid Grid.Row="0"
              Margin="0,0,0,8">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>
          <TextBlock
            Style="{StaticResource SubtitleTextBlockStyle}"
            Text="Dump Files" />
          <StackPanel
            Grid.Column="1"
            Orientation="Horizontal"
            Spacing="8">
            <Button
              Click="SelectAllButton_Click"
              Content="Select All" />
            <Button
              Click="SelectNoneButton_Click"
              Content="Select None" />
          </StackPanel>
        </Grid>

        <!--  Sortable column headers  -->
        <Grid
          Grid.Row="1"
          Margin="0,0,0,4"
          Padding="8,4"
          Background="{ThemeResource SystemControlBackgroundListLowBrush}"
          CornerRadius="4">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="40" />
            <ColumnDefinition Width="*"
                              MinWidth="150" />
            <ColumnDefinition Width="100" />
            <ColumnDefinition Width="*"
                              MinWidth="200" />
          </Grid.ColumnDefinitions>
          <TextBlock
            Grid.Column="0"
            FontWeight="SemiBold"
            Text="" />
          <Button
            Grid.Column="1"
            Padding="0"
            HorizontalAlignment="Left"
            Background="Transparent"
            BorderThickness="0"
            Click="SortByFilename_Click">
            <StackPanel Orientation="Horizontal"
                        Spacing="4">
              <TextBlock FontWeight="SemiBold"
                         Text="Filename" />
              <FontIcon
                x:Name="FilenameSortIcon"
                FontSize="10"
                Glyph=""
                Visibility="Collapsed" />
            </StackPanel>
          </Button>
          <Button
            Grid.Column="2"
            Padding="0"
            HorizontalAlignment="Left"
            Background="Transparent"
            BorderThickness="0"
            Click="SortBySize_Click">
            <StackPanel Orientation="Horizontal"
                        Spacing="4">
              <TextBlock FontWeight="SemiBold"
                         Text="Size" />
              <FontIcon
                x:Name="SizeSortIcon"
                FontSize="10"
                Glyph=""
                Visibility="Collapsed" />
            </StackPanel>
          </Button>
          <Button
            Grid.Column="3"
            Padding="0"
            HorizontalAlignment="Left"
            Background="Transparent"
            BorderThickness="0"
            Click="SortByStatus_Click">
            <StackPanel Orientation="Horizontal"
                        Spacing="4">
              <TextBlock FontWeight="SemiBold"
                         Text="Status" />
              <FontIcon
                x:Name="StatusSortIcon"
                FontSize="10"
                Glyph=""
                Visibility="Collapsed" />
            </StackPanel>
          </Button>
        </Grid>

        <ListView
          x:Name="DumpFilesListView"
          Grid.Row="2"
          SelectionMode="None">
          <ListView.ItemTemplate>
            <DataTemplate x:DataType="local:DumpFileEntry">
              <Grid Padding="8,4">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="40" />
                  <ColumnDefinition Width="*"
                                    MinWidth="150" />
                  <ColumnDefinition Width="100" />
                  <ColumnDefinition Width="*"
                                    MinWidth="200" />
                </Grid.ColumnDefinitions>
                <CheckBox
                  Grid.Column="0"
                  MinWidth="0"
                  IsChecked="{x:Bind IsSelected, Mode=TwoWay}" />
                <TextBlock
                  Grid.Column="1"
                  VerticalAlignment="Center"
                  FontSize="11"
                  Text="{x:Bind FileName}"
                  TextTrimming="CharacterEllipsis"
                  ToolTipService.ToolTip="{x:Bind FilePath}" />
                <TextBlock
                  Grid.Column="2"
                  VerticalAlignment="Center"
                  FontSize="11"
                  Text="{x:Bind SizeFormatted}" />
                <TextBlock
                  Grid.Column="3"
                  VerticalAlignment="Center"
                  FontSize="11"
                  Foreground="{x:Bind StatusColor, Mode=OneWay}"
                  Text="{x:Bind Status, Mode=OneWay}"
                  TextTrimming="CharacterEllipsis"
                  TextWrapping="NoWrap"
                  ToolTipService.ToolTip="{x:Bind Status, Mode=OneWay}" />
              </Grid>
            </DataTemplate>
          </ListView.ItemTemplate>
        </ListView>
      </Grid>
    </Border>

    <!--  BOTTOM: File Types, Options, and Process Button - transparent for Mica  -->
    <Grid
      Grid.Row="3"
      Margin="0,8,0,0">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>

      <!--  File Type Filters  -->
      <Expander
        Grid.Row="0"
        Margin="0,0,0,8"
        HorizontalAlignment="Stretch"
        HorizontalContentAlignment="Stretch"
        CornerRadius="4"
        Header="File Types to Extract">
        <ctk:WrapPanel
          x:Name="FileTypeCheckboxPanel"
          HorizontalSpacing="16"
          VerticalSpacing="8">
          <!--  Checkboxes will be generated dynamically  -->
        </ctk:WrapPanel>
      </Expander>

      <!--  Progress Text  -->
      <TextBlock
        x:Name="ProgressTextBlock"
        Grid.Row="1"
        Margin="0,0,0,8"
        FontSize="12"
        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
        Text=""
        Visibility="Collapsed" />

      <!--  Options and Action Buttons  -->
      <Grid Grid.Row="2">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <StackPanel
          Grid.Column="0"
          VerticalAlignment="Center"
          Orientation="Horizontal"
          Spacing="16">
          <!--  Conversion Options  -->
          <StackPanel Orientation="Horizontal"
                      Spacing="8">
            <CheckBox
              x:Name="BatchConvertDdxCheckBox"
              MinWidth="0"
              Content="Convert Formats"
              ToolTipService.ToolTip="Convert DDX→DDS textures and XUR→XUI interfaces"
              IsChecked="True" />
            <CheckBox
              x:Name="BatchSaveAtlasCheckBox"
              Margin="16,0,0,0"
              Content="Save Atlas Files" />
          </StackPanel>

          <Border Width="1"
                  Height="20"
                  Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

          <!--  Batch Options  -->
          <StackPanel Orientation="Horizontal"
                      Spacing="8">
            <TextBlock
              Margin="0,0,0,2"
              VerticalAlignment="Center"
              Text="Threads:" />
            <NumberBox
              x:Name="ParallelCountBox"
              MinWidth="50"
              Margin="-4,0,0,0"
              VerticalAlignment="Center"
              Minimum="1"
              SpinButtonPlacementMode="Hidden"
              Value="2"
              ValueChanged="ParallelCountBox_ValueChanged" />
            <CheckBox
              x:Name="SkipExistingCheckBox"
              Margin="16,0,0,0"
              Content="Skip Existing"
              IsChecked="True" />
            <CheckBox
              x:Name="BatchVerboseCheckBox"
              MinWidth="0"
              Content="Verbose"
              ToolTipService.ToolTip="Output detailed progress to the terminal (when launched from command line)" />
          </StackPanel>
        </StackPanel>

        <StackPanel
          Grid.Column="1"
          Orientation="Horizontal"
          Spacing="8">
          <TextBlock
            x:Name="StatusTextBlock"
            VerticalAlignment="Center"
            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
            Text="" />
          <Button
            x:Name="CancelButton"
            MinWidth="80"
            Click="CancelButton_Click"
            Content="Cancel"
            IsEnabled="False" />
          <Button
            x:Name="ExtractButton"
            MinWidth="120"
            Click="ExtractButton_Click"
            Content="Extract Files"
            IsEnabled="False"
            Style="{StaticResource AccentButtonStyle}" />
        </StackPanel>
      </Grid>
    </Grid>
  </Grid>
</UserControl>
