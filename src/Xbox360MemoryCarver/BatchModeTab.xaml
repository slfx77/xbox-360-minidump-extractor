<?xml version="1.0" encoding="utf-8"?>

<UserControl
  x:Class="Xbox360MemoryCarver.App.BatchModeTab"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:local="using:Xbox360MemoryCarver.App">

  <Grid Padding="16">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!--  Input/Output Section  -->
    <StackPanel
      Grid.Row="0"
      Spacing="12">
      <!--  Input Directory  -->
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <TextBox
          x:Name="InputDirectoryTextBox"
          Header="Input Directory (containing .dmp files)"
          IsReadOnly="True"
          PlaceholderText="Select a folder containing memory dumps..." />
        <Button
          Grid.Column="1"
          Margin="8,22,0,0"
          Click="BrowseInputButton_Click"
          Content="Browse..." />
      </Grid>

      <!--  Output Directory  -->
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <TextBox
          x:Name="OutputDirectoryTextBox"
          Header="Output Directory"
          IsReadOnly="True"
          PlaceholderText="Select output directory..." />
        <Button
          Grid.Column="1"
          Margin="8,22,0,0"
          Click="BrowseOutputButton_Click"
          Content="Browse..." />
      </Grid>

      <!--  Scan Button  -->
      <Button
        x:Name="ScanButton"
        HorizontalAlignment="Left"
        Click="ScanButton_Click"
        Content="Scan for Dumps"
        IsEnabled="False"
        Style="{StaticResource AccentButtonStyle}" />
    </StackPanel>

    <!--  File List  -->
    <Border
      Grid.Row="1"
      Margin="0,16,0,0"
      Padding="8"
      Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}"
      CornerRadius="8">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid
          Grid.Row="0"
          Margin="0,0,0,8">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>
          <TextBlock
            Style="{StaticResource SubtitleTextBlockStyle}"
            Text="Dump Files" />
          <StackPanel
            Grid.Column="1"
            Orientation="Horizontal"
            Spacing="8">
            <Button
              Click="SelectAllButton_Click"
              Content="Select All"
              Style="{StaticResource DefaultButtonStyle}" />
            <Button
              Click="SelectNoneButton_Click"
              Content="Select None"
              Style="{StaticResource DefaultButtonStyle}" />
          </StackPanel>
        </Grid>

        <ListView
          x:Name="DumpFilesListView"
          Grid.Row="1"
          SelectionMode="Multiple">
          <ListView.ItemTemplate>
            <DataTemplate x:DataType="local:DumpFileEntry">
              <Grid Padding="8,4">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="100" />
                  <ColumnDefinition Width="120" />
                </Grid.ColumnDefinitions>
                <CheckBox
                  Grid.Column="0"
                  Margin="0,0,8,0"
                  IsChecked="{x:Bind IsSelected, Mode=TwoWay}" />
                <TextBlock
                  Grid.Column="1"
                  VerticalAlignment="Center"
                  Text="{x:Bind FileName}" />
                <TextBlock
                  Grid.Column="2"
                  VerticalAlignment="Center"
                  Text="{x:Bind SizeFormatted}" />
                <TextBlock
                  Grid.Column="3"
                  VerticalAlignment="Center"
                  Foreground="{x:Bind StatusColor}"
                  Text="{x:Bind Status}" />
              </Grid>
            </DataTemplate>
          </ListView.ItemTemplate>
        </ListView>
      </Grid>
    </Border>

    <!--  Options  -->
    <Border
      Grid.Row="2"
      Margin="0,8,0,0"
      Padding="12"
      Background="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}"
      CornerRadius="8">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <StackPanel
          Grid.Column="0"
          Spacing="8">
          <TextBlock
            FontWeight="SemiBold"
            Text="Extraction Options" />
          <CheckBox
            x:Name="BatchConvertDdxCheckBox"
            Content="Convert DDX to DDS"
            IsChecked="True" />
          <CheckBox
            x:Name="BatchSaveAtlasCheckBox"
            Content="Save Atlas Files" />
          <CheckBox
            x:Name="BatchVerboseCheckBox"
            Content="Verbose Output" />
        </StackPanel>

        <StackPanel
          Grid.Column="1"
          Spacing="8">
          <TextBlock
            FontWeight="SemiBold"
            Text="Processing Options" />
          <StackPanel
            Orientation="Horizontal"
            Spacing="8">
            <TextBlock
              VerticalAlignment="Center"
              Text="Max Parallel:" />
            <NumberBox
              x:Name="ParallelCountBox"
              Maximum="8"
              Minimum="1"
              SpinButtonPlacementMode="Compact"
              Value="2" />
          </StackPanel>
          <CheckBox
            x:Name="SkipExistingCheckBox"
            Content="Skip already extracted"
            IsChecked="True" />
        </StackPanel>
      </Grid>
    </Border>

    <!--  Progress and Actions  -->
    <Grid
      Grid.Row="3"
      Margin="0,16,0,0">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <StackPanel
        Grid.Row="0"
        Grid.ColumnSpan="2"
        Margin="0,0,0,8"
        Spacing="4">
        <ProgressBar
          x:Name="BatchProgressBar"
          Visibility="Collapsed"
          Value="0" />
        <TextBlock
          x:Name="ProgressTextBlock"
          FontSize="12"
          Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
          Text="" />
      </StackPanel>

      <TextBlock
        x:Name="StatusTextBlock"
        Grid.Row="1"
        Grid.Column="0"
        VerticalAlignment="Center"
        Text="Select a folder to scan for dump files" />

      <StackPanel
        Grid.Row="1"
        Grid.Column="1"
        Orientation="Horizontal"
        Spacing="8">
        <Button
          x:Name="CancelButton"
          Click="CancelButton_Click"
          Content="Cancel"
          IsEnabled="False" />
        <Button
          x:Name="ProcessButton"
          MinWidth="140"
          Click="ProcessButton_Click"
          Content="Process Selected"
          IsEnabled="False"
          Style="{StaticResource AccentButtonStyle}" />
      </StackPanel>
    </Grid>
  </Grid>
</UserControl>
