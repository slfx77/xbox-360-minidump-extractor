<?xml version="1.0" encoding="utf-8"?>

<UserControl
  x:Class="Xbox360MemoryCarver.App.HexViewerControl"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

  <Grid>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="*" />
      <ColumnDefinition Width="120" />
    </Grid.ColumnDefinitions>

    <!--  Main Hex View  -->
    <Grid Grid.Column="0">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
      </Grid.RowDefinitions>

      <!--  Legend - populated dynamically from FileTypeColors  -->
      <Border
        Grid.Row="0"
        Margin="0,0,0,4"
        Padding="8,4"
        Background="#FF1E1E1E"
        CornerRadius="4">
        <StackPanel
          x:Name="LegendPanel"
          Orientation="Horizontal"
          Spacing="12" />
      </Border>

      <!--  Hex content with custom virtualization  -->
      <Border
        Grid.Row="1"
        Background="#FF1E1E1E"
        CornerRadius="4">
        <Grid>
          <!--  Custom ScrollBar for virtual scrolling  -->
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>

          <!--  Hex display area with horizontal scrolling  -->
          <Border
            x:Name="HexDisplayArea"
            Grid.Row="0"
            Grid.Column="0"
            Background="#FF1E1E1E"
            SizeChanged="HexDisplayArea_SizeChanged">
            <ScrollViewer
              Padding="4"
              HorizontalScrollBarVisibility="Auto"
              VerticalScrollBarVisibility="Disabled">
              <TextBlock
                x:Name="HexTextBlock"
                VerticalAlignment="Top"
                FontFamily="Consolas"
                FontSize="12"
                IsTextSelectionEnabled="True"
                TextWrapping="NoWrap" />
            </ScrollViewer>
          </Border>

          <!--  Virtual scrollbar using Slider - tooltip disabled, using custom hex indicator  -->
          <Slider
            x:Name="VirtualScrollBar"
            Grid.Row="0"
            Grid.Column="1"
            MinWidth="20"
            Margin="4,0,0,0"
            IsDirectionReversed="True"
            Maximum="100"
            Minimum="0"
            Orientation="Vertical"
            SnapsTo="StepValues"
            StepFrequency="1"
            TickFrequency="0"
            ToolTipService.ToolTip="{x:Null}"
            ValueChanged="VirtualScrollBar_ValueChanged" />

          <!--  Position indicator in hex  -->
          <TextBlock
            x:Name="PositionIndicator"
            Grid.Row="1"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Padding="4,2"
            FontFamily="Consolas"
            FontSize="10"
            Foreground="#FF888888"
            Text="Offset: 0x00000000" />
        </Grid>
      </Border>
    </Grid>

    <!--  Minimap Panel  -->
    <Border
      Grid.Column="1"
      Margin="4,0,0,0"
      Background="#FF252526"
      BorderBrush="#FF3C3C3C"
      BorderThickness="1,0,0,0">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBlock
          Grid.Row="0"
          Margin="0,4,0,2"
          HorizontalAlignment="Center"
          FontSize="10"
          Foreground="#FF888888"
          Text="Minimap" />

        <!--  Zoom controls  -->
        <Grid
          Grid.Row="1"
          Margin="4,0,4,4"
          HorizontalAlignment="Stretch">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>
          <TextBlock
            Grid.Column="0"
            VerticalAlignment="Center"
            FontSize="9"
            Foreground="#FF666666"
            Text="1x" />
          <Slider
            x:Name="MinimapZoomSlider"
            Grid.Column="1"
            Height="20"
            HorizontalAlignment="Stretch"
            Maximum="10"
            Minimum="1"
            ToolTipService.ToolTip="Minimap Zoom"
            ValueChanged="MinimapZoomSlider_ValueChanged"
            Value="1" />
          <TextBlock
            Grid.Column="2"
            VerticalAlignment="Center"
            FontSize="9"
            Foreground="#FF666666"
            Text="10x" />
        </Grid>

        <!--  Minimap container  -->
        <Border
          x:Name="MinimapContainer"
          Grid.Row="2"
          Margin="4"
          Background="#FF2D2D2D"
          CornerRadius="4"
          SizeChanged="MinimapContainer_SizeChanged">
          <ScrollViewer
            x:Name="MinimapScrollViewer"
            HorizontalScrollBarVisibility="Disabled"
            VerticalScrollBarVisibility="Auto">
            <Canvas
              x:Name="MinimapCanvas"
              Background="Transparent"
              PointerMoved="Minimap_PointerMoved"
              PointerPressed="Minimap_PointerPressed"
              PointerReleased="Minimap_PointerReleased">
              <Border
                x:Name="ViewportIndicator"
                Background="#40FFFFFF"
                BorderBrush="#FFFFFFFF"
                BorderThickness="2"
                CornerRadius="2"
                Visibility="Collapsed" />
            </Canvas>
          </ScrollViewer>
        </Border>
      </Grid>
    </Border>
  </Grid>
</UserControl>
