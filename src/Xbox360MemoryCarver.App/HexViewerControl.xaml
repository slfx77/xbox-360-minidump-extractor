<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="Xbox360MemoryCarver.App.HexViewerControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Xbox360MemoryCarver.App">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="120"/>
        </Grid.ColumnDefinitions>

        <!-- Main Hex View -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Legend - populated dynamically from FileTypeColors -->
            <Border Grid.Row="0"
                    Background="#FF1E1E1E"
                    Padding="8,4"
                    CornerRadius="4"
                    Margin="0,0,0,4">
                <StackPanel x:Name="LegendPanel"
                            Orientation="Horizontal"
                            Spacing="12"/>
            </Border>

            <!-- Hex content with custom virtualization -->
            <Border Grid.Row="1"
                    Background="#FF1E1E1E"
                    CornerRadius="4">
                <Grid>
                    <!-- Custom ScrollBar for virtual scrolling -->
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Hex display area with horizontal scrolling -->
                    <Border x:Name="HexDisplayArea"
                            Grid.Column="0"
                            Grid.Row="0"
                            Background="#FF1E1E1E"
                            SizeChanged="HexDisplayArea_SizeChanged">
                        <ScrollViewer HorizontalScrollBarVisibility="Auto"
                                      VerticalScrollBarVisibility="Disabled"
                                      Padding="4">
                            <TextBlock x:Name="HexTextBlock"
                                       FontFamily="Consolas"
                                       FontSize="12"
                                       IsTextSelectionEnabled="True"
                                       TextWrapping="NoWrap"
                                       VerticalAlignment="Top"/>
                        </ScrollViewer>
                    </Border>

                    <!-- Virtual scrollbar using Slider - tooltip disabled, using custom hex indicator -->
                    <Slider x:Name="VirtualScrollBar"
                            Grid.Column="1"
                            Grid.Row="0"
                            Orientation="Vertical"
                            IsDirectionReversed="True"
                            ValueChanged="VirtualScrollBar_ValueChanged"
                            Minimum="0"
                            Maximum="100"
                            MinWidth="20"
                            Margin="4,0,0,0"
                            TickFrequency="0"
                            SnapsTo="StepValues"
                            StepFrequency="1"
                            ToolTipService.ToolTip="{x:Null}"/>

                    <!-- Position indicator in hex -->
                    <TextBlock x:Name="PositionIndicator"
                               Grid.Column="0"
                               Grid.ColumnSpan="2"
                               Grid.Row="1"
                               FontFamily="Consolas"
                               FontSize="10"
                               Foreground="#FF888888"
                               Padding="4,2"
                               Text="Offset: 0x00000000"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Minimap Panel -->
        <Border Grid.Column="1"
                Background="#FF252526"
                BorderBrush="#FF3C3C3C"
                BorderThickness="1,0,0,0"
                Margin="4,0,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0"
                           Text="Minimap"
                           FontSize="10"
                           Foreground="#FF888888"
                           HorizontalAlignment="Center"
                           Margin="0,4,0,2"/>

                <!-- Zoom controls -->
                <Grid Grid.Row="1"
                      HorizontalAlignment="Stretch"
                      Margin="4,0,4,4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0"
                               Text="1x"
                               FontSize="9"
                               Foreground="#FF666666"
                               VerticalAlignment="Center"/>
                    <Slider x:Name="MinimapZoomSlider"
                            Grid.Column="1"
                            Minimum="1"
                            Maximum="10"
                            Value="1"
                            Height="20"
                            HorizontalAlignment="Stretch"
                            ValueChanged="MinimapZoomSlider_ValueChanged"
                            ToolTipService.ToolTip="Minimap Zoom"/>
                    <TextBlock Grid.Column="2"
                               Text="10x"
                               FontSize="9"
                               Foreground="#FF666666"
                               VerticalAlignment="Center"/>
                </Grid>

                <!-- Minimap container -->
                <Border x:Name="MinimapContainer"
                        Grid.Row="2"
                        Margin="4"
                        Background="#FF2D2D2D"
                        CornerRadius="4"
                        SizeChanged="MinimapContainer_SizeChanged">
                    <ScrollViewer x:Name="MinimapScrollViewer"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <Canvas x:Name="MinimapCanvas"
                                PointerPressed="Minimap_PointerPressed"
                                PointerMoved="Minimap_PointerMoved"
                                PointerReleased="Minimap_PointerReleased"
                                Background="Transparent">
                            <Border x:Name="ViewportIndicator"
                                    BorderBrush="#FFFFFFFF"
                                    BorderThickness="2"
                                    Background="#40FFFFFF"
                                    CornerRadius="2"
                                    Visibility="Collapsed"/>
                        </Canvas>
                    </ScrollViewer>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>
