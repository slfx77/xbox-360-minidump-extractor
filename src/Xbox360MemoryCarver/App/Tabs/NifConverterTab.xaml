<?xml version="1.0" encoding="utf-8"?>

<UserControl
  x:Class="Xbox360MemoryCarver.NifConverterTab"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:local="using:Xbox360MemoryCarver">

  <Grid Padding="16">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Header with description -->
    <StackPanel Grid.Row="0"
                Margin="0,0,0,16">
      <TextBlock
        Style="{StaticResource SubtitleTextBlockStyle}"
        Text="Xbox 360 NIF Converter"/>
      <TextBlock
        Margin="0,4,0,0"
        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
        TextWrapping="Wrap"
        Text="Convert Xbox 360 NIF files to PC format. This includes endian conversion and unpacking BSPackedAdditionalGeometryData geometry."/>
    </StackPanel>

    <!-- Input/Output Section -->
    <Grid
      Grid.Row="1"
      Margin="0,0,0,8"
      RowSpacing="8">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>

      <!-- Input Directory -->
      <TextBlock
        Grid.Row="0"
        Grid.Column="0"
        Margin="0,0,12,0"
        VerticalAlignment="Center"
        Text="Input Directory"/>
      <TextBox
        x:Name="InputDirectoryTextBox"
        Grid.Row="0"
        Grid.Column="1"
        Margin="0,0,8,0"
        PlaceholderText="Select or enter a folder containing Xbox 360 .nif files..."
        TextChanged="InputDirectoryTextBox_TextChanged"/>
      <Button
        Grid.Row="0"
        Grid.Column="2"
        Click="BrowseInputButton_Click"
        Content="Browse..."/>

      <!-- Output Directory -->
      <TextBlock
        Grid.Row="1"
        Grid.Column="0"
        Margin="0,0,12,0"
        VerticalAlignment="Center"
        Text="Output Directory"/>
      <TextBox
        x:Name="OutputDirectoryTextBox"
        Grid.Row="1"
        Grid.Column="1"
        Margin="0,0,8,0"
        PlaceholderText="Select or enter output directory for converted files..."
        TextChanged="OutputDirectoryTextBox_TextChanged"/>
      <Button
        Grid.Row="1"
        Grid.Column="2"
        Click="BrowseOutputButton_Click"
        Content="Browse..."/>
    </Grid>

    <!-- Progress Section -->
    <Grid Grid.Row="2"
          Margin="0,0,0,8">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>
      <ProgressBar
        x:Name="ScanProgressBar"
        Grid.Row="0"
        Margin="0,0,0,4"
        Visibility="Collapsed"
        Value="0"/>
      <ProgressBar
        x:Name="ConversionProgressBar"
        Grid.Row="1"
        Margin="0,0,0,4"
        Visibility="Collapsed"
        Value="0"/>
      <TextBlock
        x:Name="StatusTextBlock"
        Grid.Row="2"
        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
        Text=""/>
    </Grid>

    <!-- Files List -->
    <Border
      Grid.Row="3"
      Padding="8"
      Background="#80202020"
      CornerRadius="8">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0"
              Margin="0,0,0,8">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>
          <StackPanel Orientation="Horizontal"
                      Spacing="8">
            <TextBlock
              Style="{StaticResource SubtitleTextBlockStyle}"
              Text="NIF Files"/>
            <TextBlock
              x:Name="FileCountTextBlock"
              VerticalAlignment="Center"
              Foreground="{ThemeResource TextFillColorSecondaryBrush}"
              Text=""/>
          </StackPanel>
          <StackPanel
            Grid.Column="1"
            Orientation="Horizontal"
            Spacing="8">
            <Button
              Click="SelectAllButton_Click"
              Content="Select All"/>
            <Button
              Click="SelectNoneButton_Click"
              Content="Select None"/>
          </StackPanel>
        </Grid>

        <!-- Column headers -->
        <Grid Grid.Row="1"
              Margin="0,0,0,4"
              Padding="8,4"
              Background="{ThemeResource SystemControlBackgroundListLowBrush}"
              CornerRadius="4">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="40"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="80"/>
            <ColumnDefinition Width="120"/>
            <ColumnDefinition Width="250"/>
          </Grid.ColumnDefinitions>
          <TextBlock Grid.Column="0"
                     FontWeight="SemiBold"
                     Text=""/>
          <Button
            Grid.Column="1"
            Padding="0"
            HorizontalAlignment="Left"
            Background="Transparent"
            BorderThickness="0"
            Click="SortByFilePath_Click">
            <StackPanel Orientation="Horizontal"
                        Spacing="4">
              <TextBlock FontWeight="SemiBold"
                         Text="File Path"/>
              <FontIcon
                x:Name="FilePathSortIcon"
                FontSize="10"
                Glyph=""
                Visibility="Collapsed"/>
            </StackPanel>
          </Button>
          <Button
            Grid.Column="2"
            Padding="0"
            HorizontalAlignment="Left"
            Background="Transparent"
            BorderThickness="0"
            Click="SortBySize_Click">
            <StackPanel Orientation="Horizontal"
                        Spacing="4">
              <TextBlock FontWeight="SemiBold"
                         Text="Size"/>
              <FontIcon
                x:Name="SizeSortIcon"
                FontSize="10"
                Glyph=""
                Visibility="Collapsed"/>
            </StackPanel>
          </Button>
          <Button
            Grid.Column="3"
            Padding="0"
            HorizontalAlignment="Left"
            Background="Transparent"
            BorderThickness="0"
            Click="SortByFormat_Click">
            <StackPanel Orientation="Horizontal"
                        Spacing="4">
              <TextBlock FontWeight="SemiBold"
                         Text="Format"/>
              <FontIcon
                x:Name="FormatSortIcon"
                FontSize="10"
                Glyph=""
                Visibility="Collapsed"/>
            </StackPanel>
          </Button>
          <Button
            Grid.Column="4"
            Padding="0"
            HorizontalAlignment="Left"
            Background="Transparent"
            BorderThickness="0"
            Click="SortByStatus_Click">
            <StackPanel Orientation="Horizontal"
                        Spacing="4">
              <TextBlock FontWeight="SemiBold"
                         Text="Status"/>
              <FontIcon
                x:Name="StatusSortIcon"
                FontSize="10"
                Glyph=""
                Visibility="Collapsed"/>
            </StackPanel>
          </Button>
        </Grid>

        <!-- Files ListView -->
        <ListView
          x:Name="NifFilesListView"
          Grid.Row="2"
          SelectionMode="None">
          <ListView.ItemTemplate>
            <DataTemplate x:DataType="local:NifFileEntry">
              <Grid Margin="0,2">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="40"/>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="80"/>
                  <ColumnDefinition Width="120"/>
                  <ColumnDefinition Width="250"/>
                </Grid.ColumnDefinitions>
                <CheckBox
                  Grid.Column="0"
                  IsChecked="{x:Bind IsSelected, Mode=TwoWay}"/>
                <TextBlock
                  Grid.Column="1"
                  VerticalAlignment="Center"
                  Text="{x:Bind RelativePath}"
                  TextTrimming="CharacterEllipsis"
                  ToolTipService.ToolTip="{x:Bind FullPath}"/>
                <TextBlock
                  Grid.Column="2"
                  VerticalAlignment="Center"
                  Text="{x:Bind FileSizeDisplay}"/>
                <TextBlock
                  Grid.Column="3"
                  VerticalAlignment="Center"
                  Foreground="{x:Bind FormatColor, Mode=OneWay}"
                  Text="{x:Bind FormatDescription, Mode=OneWay}"/>
                <TextBlock
                  Grid.Column="4"
                  VerticalAlignment="Center"
                  Foreground="{x:Bind StatusColor, Mode=OneWay}"
                  Text="{x:Bind Status, Mode=OneWay}"
                  TextTrimming="CharacterEllipsis"
                  ToolTipService.ToolTip="{x:Bind Status, Mode=OneWay}"/>
              </Grid>
            </DataTemplate>
          </ListView.ItemTemplate>
        </ListView>
      </Grid>
    </Border>

    <!-- Bottom Action Bar -->
    <Grid
      Grid.Row="4"
      Margin="0,12,0,0"
      ColumnSpacing="16">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>

      <!-- Options -->
      <CheckBox
        x:Name="PreserveStructureCheckBox"
        Grid.Column="0"
        Content="Preserve folder structure"
        IsChecked="True"/>
      <CheckBox
        x:Name="OverwriteExistingCheckBox"
        Grid.Column="1"
        Content="Overwrite existing files"
        IsChecked="False"/>
      <CheckBox
        x:Name="VerboseOutputCheckBox"
        Grid.Column="2"
        Content="Verbose output"
        IsChecked="False"/>

      <!-- Action buttons -->
      <Button
        x:Name="CancelButton"
        Grid.Column="4"
        Click="CancelButton_Click"
        Content="Cancel"
        IsEnabled="False"/>
      <Button
        x:Name="ConvertButton"
        Grid.Column="5"
        Click="ConvertButton_Click"
        Content="Convert Selected"
        IsEnabled="False"
        Style="{StaticResource AccentButtonStyle}"/>
    </Grid>
  </Grid>
</UserControl>
